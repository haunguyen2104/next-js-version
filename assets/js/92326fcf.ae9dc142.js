"use strict";(self.webpackChunknext_version=self.webpackChunknext_version||[]).push([[4696],{2080:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var n=s(5893),o=s(1151);const i={description:"A custom asset prefix allows you serve static assets from a CDN. Learn more about it here."},r="CDN Support with Asset Prefix",c={id:"next-js/v13.0.0/api-reference/next.config.js/cdn-support-with-asset-prefix",title:"CDN Support with Asset Prefix",description:"A custom asset prefix allows you serve static assets from a CDN. Learn more about it here.",source:"@site/docs/next-js/v13.0.0/api-reference/next.config.js/cdn-support-with-asset-prefix.md",sourceDirName:"next-js/v13.0.0/api-reference/next.config.js",slug:"/next-js/v13.0.0/api-reference/next.config.js/cdn-support-with-asset-prefix",permalink:"/next-js/v13.0.0/api-reference/next.config.js/cdn-support-with-asset-prefix",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/next-js/v13.0.0/api-reference/next.config.js/cdn-support-with-asset-prefix.md",tags:[],version:"current",frontMatter:{description:"A custom asset prefix allows you serve static assets from a CDN. Learn more about it here."},sidebar:"tutorialSidebar",previous:{title:"Build indicator",permalink:"/next-js/v13.0.0/api-reference/next.config.js/build-indicator"},next:{title:"Compression",permalink:"/next-js/v13.0.0/api-reference/next.config.js/compression"}},a={},d=[{value:"Related",id:"related",level:2}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"cdn-support-with-asset-prefix",children:"CDN Support with Asset Prefix"}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Attention"}),": ",(0,n.jsx)(t.a,{href:"/docs/deployment.md",children:"Deploying to Vercel"})," automatically configures a global CDN for your Next.js project.\nYou do not need to manually setup an Asset Prefix."]}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Note"}),": Next.js 9.5+ added support for a customizable ",(0,n.jsx)(t.a,{href:"/docs/api-reference/next.config.js/basepath.md",children:"Base Path"}),", which is better\nsuited for hosting your application on a sub-path like ",(0,n.jsx)(t.code,{children:"/docs"}),".\nWe do not suggest you use a custom Asset Prefix for this use case."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["To set up a ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Content_delivery_network",children:"CDN"}),", you can set up an asset prefix and configure your CDN's origin to resolve to the domain that Next.js is hosted on."]}),"\n",(0,n.jsxs)(t.p,{children:["Open ",(0,n.jsx)(t.code,{children:"next.config.js"})," and add the ",(0,n.jsx)(t.code,{children:"assetPrefix"})," config:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"const isProd = process.env.NODE_ENV === 'production'\n\nmodule.exports = {\n  // Use the CDN in production and localhost for development.\n  assetPrefix: isProd ? 'https://cdn.mydomain.com' : undefined,\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Next.js will automatically use your asset prefix for the JavaScript and CSS files it loads from the ",(0,n.jsx)(t.code,{children:"/_next/"})," path (",(0,n.jsx)(t.code,{children:".next/static/"})," folder). For example, with the above configuration, the following request for a JS chunk:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"/_next/static/chunks/4b9b41aaa062cbbfeff4add70f256968c51ece5d.4d708494b3aed70c04f0.js\n"})}),"\n",(0,n.jsx)(t.p,{children:"Would instead become:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"https://cdn.mydomain.com/_next/static/chunks/4b9b41aaa062cbbfeff4add70f256968c51ece5d.4d708494b3aed70c04f0.js\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The exact configuration for uploading your files to a given CDN will depend on your CDN of choice. The only folder you need to host on your CDN is the contents of ",(0,n.jsx)(t.code,{children:".next/static/"}),", which should be uploaded as ",(0,n.jsx)(t.code,{children:"_next/static/"})," as the above URL request indicates. ",(0,n.jsxs)(t.strong,{children:["Do not upload the rest of your ",(0,n.jsx)(t.code,{children:".next/"})," folder"]}),", as you should not expose your server code and other configuration to the public."]}),"\n",(0,n.jsxs)(t.p,{children:["While ",(0,n.jsx)(t.code,{children:"assetPrefix"})," covers requests to ",(0,n.jsx)(t.code,{children:"_next/static"}),", it does not influence the following paths:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Files in the ",(0,n.jsx)(t.a,{href:"/docs/basic-features/static-file-serving.md",children:"public"})," folder; if you want to serve those assets over a CDN, you'll have to introduce the prefix yourself"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"/_next/data/"})," requests for ",(0,n.jsx)(t.code,{children:"getServerSideProps"})," pages. These requests will always be made against the main domain since they're not static."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"/_next/data/"})," requests for ",(0,n.jsx)(t.code,{children:"getStaticProps"})," pages. These requests will always be made against the main domain to support ",(0,n.jsx)(t.a,{href:"/docs/basic-features/data-fetching/incremental-static-regeneration.md",children:"Incremental Static Generation"}),", even if you're not using it (for consistency)."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"related",children:"Related"}),"\n",(0,n.jsx)("div",{class:"card",children:(0,n.jsxs)("a",{href:"/docs/api-reference/next.config.js/introduction.md",children:[(0,n.jsx)("b",{children:"Introduction to next.config.js:"}),(0,n.jsx)("small",{children:"Learn more about the configuration file used by Next.js."})]})}),"\n",(0,n.jsx)("div",{class:"card",children:(0,n.jsxs)("a",{href:"/docs/basic-features/static-file-serving.md",children:[(0,n.jsx)("b",{children:"Static File Serving:"}),(0,n.jsx)("small",{children:"Serve static files, like images, in the public directory."})]})})]})}function h(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},1151:(e,t,s)=>{s.d(t,{Z:()=>c,a:()=>r});var n=s(7294);const o={},i=n.createContext(o);function r(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);