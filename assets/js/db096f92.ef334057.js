"use strict";(self.webpackChunknext_version=self.webpackChunknext_version||[]).push([[7117],{292:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var r=n(5893),i=n(1151);const s={},d="Switchable Runtime (Alpha)",a={id:"next-js/v13.0.0/advanced-features/react-18/switchable-runtime",title:"Switchable Runtime (Alpha)",description:"Next.js has two server runtimes to run your application: the Node.js Runtime (default) and the Edge Runtime. When server-rendering or serving API routes, the application code will be executed in the Node.js Runtime by default; and for Middleware, it will be running in the Edge Runtime.",source:"@site/docs/next-js/v13.0.0/advanced-features/react-18/switchable-runtime.md",sourceDirName:"next-js/v13.0.0/advanced-features/react-18",slug:"/next-js/v13.0.0/advanced-features/react-18/switchable-runtime",permalink:"/next-js/v13.0.0/advanced-features/react-18/switchable-runtime",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/next-js/v13.0.0/advanced-features/react-18/switchable-runtime.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Streaming SSR",permalink:"/next-js/v13.0.0/advanced-features/react-18/streaming"},next:{title:"Security Headers",permalink:"/next-js/v13.0.0/advanced-features/security-headers"}},l={},c=[{value:"Global Runtime Option",id:"global-runtime-option",level:2},{value:"Page Runtime Option",id:"page-runtime-option",level:2},{value:"Edge API Routes",id:"edge-api-routes",level:2},{value:"Related",id:"related",level:2}];function o(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"switchable-runtime-alpha",children:"Switchable Runtime (Alpha)"}),"\n",(0,r.jsxs)(t.p,{children:["Next.js has two ",(0,r.jsx)(t.em,{children:"server runtimes"})," to run your application: the ",(0,r.jsx)(t.strong,{children:"Node.js Runtime"})," (default) and the ",(0,r.jsx)(t.a,{href:"/docs/api-reference/edge-runtime.md",children:(0,r.jsx)(t.strong,{children:"Edge Runtime"})}),". When server-rendering or serving API routes, the application code will be executed in the Node.js Runtime by default; and for ",(0,r.jsx)(t.a,{href:"/docs/middleware.md",children:"Middleware"}),", it will be running in the Edge Runtime."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\xa0"}),(0,r.jsx)(t.th,{children:"Node (server)"}),(0,r.jsx)(t.th,{children:"Node (lambda)"}),(0,r.jsx)(t.th,{children:"Edge"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://vercel.com/docs/concepts/functions/conceptual-model#cold-and-hot-boots?utm_source=next-site&utm_medium=docs&utm_campaign=next-website",children:"Cold Boot"})}),(0,r.jsx)(t.td,{children:"/"}),(0,r.jsx)(t.td,{children:"~250ms"}),(0,r.jsx)(t.td,{children:"Instant"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://github.com/reactwg/react-18/discussions/37",children:"HTTP Streaming"})}),(0,r.jsx)(t.td,{children:"Yes"}),(0,r.jsx)(t.td,{children:"No"}),(0,r.jsx)(t.td,{children:"Yes"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"IO"}),(0,r.jsx)(t.td,{children:"All"}),(0,r.jsx)(t.td,{children:"All"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"fetch"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Scalability"}),(0,r.jsx)(t.td,{children:"/"}),(0,r.jsx)(t.td,{children:"High"}),(0,r.jsx)(t.td,{children:"Highest"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Security"}),(0,r.jsx)(t.td,{children:"Normal"}),(0,r.jsx)(t.td,{children:"High"}),(0,r.jsx)(t.td,{children:"High"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Latency"}),(0,r.jsx)(t.td,{children:"Normal"}),(0,r.jsx)(t.td,{children:"Low"}),(0,r.jsx)(t.td,{children:"Lowest"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Code Size"}),(0,r.jsx)(t.td,{children:"/"}),(0,r.jsx)(t.td,{children:"50MB"}),(0,r.jsx)(t.td,{children:"1MB"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"NPM Packages"}),(0,r.jsx)(t.td,{children:"All"}),(0,r.jsx)(t.td,{children:"All"}),(0,r.jsx)(t.td,{children:"A smaller subset"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["Next.js' default runtime configuration is good for most use cases, but there\u2019re still many reasons to change to one runtime over the other one. For example, to enable ",(0,r.jsx)(t.a,{href:"/docs/advanced-features/react-18/overview",children:"React 18's"})," ",(0,r.jsx)(t.a,{href:"/docs/advanced-features/react-18/streaming.md",children:"SSR streaming"})," feature, you need to use a runtime that is compatible with Web Streams. For API routes that rely on native Node.js APIs, they need to run with the ",(0,r.jsx)(t.strong,{children:"Node.js Runtime"}),". However, if an API only uses something like cookie-based authentication, using Middleware and the ",(0,r.jsx)(t.a,{href:"/docs/api-reference/edge-runtime.md",children:(0,r.jsx)(t.strong,{children:"Edge Runtime"})})," will be a better choice due to its lower latency as well as better scalability."]}),"\n",(0,r.jsxs)(t.p,{children:["Starting with ",(0,r.jsx)(t.code,{children:"12.2"}),", Next.js enables you to customize the runtime for each Next.js route, for both Pages and API routes."]}),"\n",(0,r.jsx)(t.h2,{id:"global-runtime-option",children:"Global Runtime Option"}),"\n",(0,r.jsxs)(t.p,{children:["You can set the experimental option ",(0,r.jsx)(t.code,{children:"runtime"})," to either ",(0,r.jsx)(t.code,{children:"'nodejs'"})," or ",(0,r.jsx)(t.code,{children:"'experimental-edge'"})," in your ",(0,r.jsx)(t.code,{children:"next.config.js"})," file:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:"// next.config.js\nmodule.exports = {\n  experimental: {\n    runtime: 'experimental-edge',\n  },\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"This option determines which runtime should be used as the default rendering runtime for all pages."}),"\n",(0,r.jsxs)(t.p,{children:["You can detect which runtime you're using by looking at the ",(0,r.jsx)(t.code,{children:"process.env.NEXT_RUNTIME"})," Environment Variable during runtime, and examining the ",(0,r.jsx)(t.code,{children:"options.nextRuntime"})," variable during webpack compilation."]}),"\n",(0,r.jsx)(t.h2,{id:"page-runtime-option",children:"Page Runtime Option"}),"\n",(0,r.jsxs)(t.p,{children:["On each page, you can optionally export a ",(0,r.jsx)(t.code,{children:"runtime"})," config set to either ",(0,r.jsx)(t.code,{children:"'nodejs'"})," or ",(0,r.jsx)(t.code,{children:"'experimental-edge'"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:"// pages/index.js\nexport default function Index () { ... }\n\nexport function getServerSideProps() { ... }\n\nexport const config = {\n  runtime: 'experimental-edge',\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["When both the per-page runtime and global runtime are set, the per-page runtime overrides the global runtime. If the per-page runtime is ",(0,r.jsx)(t.em,{children:"not"})," set, the global runtime option will be used."]}),"\n",(0,r.jsx)(t.h2,{id:"edge-api-routes",children:"Edge API Routes"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"/docs/api-routes/edge-api-routes.md",children:"Edge API Routes"})," enable you to build high performance APIs with Next.js using the Edge Runtime."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"export const config = {\n  runtime: 'experimental-edge',\n}\n\nexport default (req) => new Response('Hello world!')\n"})}),"\n",(0,r.jsx)(t.h2,{id:"related",children:"Related"}),"\n",(0,r.jsx)("div",{class:"card",children:(0,r.jsxs)("a",{href:"/docs/api-reference/edge-runtime.md",children:[(0,r.jsx)("b",{children:"Edge Runtime"}),(0,r.jsx)("small",{children:"Learn more about the supported Web APIs available."})]})}),"\n",(0,r.jsx)("div",{class:"card",children:(0,r.jsxs)("a",{href:"/docs/api-reference/next/server.md",children:[(0,r.jsx)("b",{children:"Middleware API Reference"}),(0,r.jsx)("small",{children:"Learn more about the supported APIs for Middleware."})]})}),"\n",(0,r.jsx)("div",{class:"card",children:(0,r.jsxs)("a",{href:"/docs/api-routes/edge-api-routes.md",children:[(0,r.jsx)("b",{children:"Edge API Routes"}),(0,r.jsx)("small",{children:"Build high performance APIs in Next.js. "})]})})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>d});var r=n(7294);const i={},s=r.createContext(i);function d(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);