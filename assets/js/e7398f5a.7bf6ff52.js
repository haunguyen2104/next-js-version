"use strict";(self.webpackChunknext_version=self.webpackChunknext_version||[]).push([[2456],{2419:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var t=r(5893),s=r(1151);const i={description:"Use codemods to update your codebase when upgrading Next.js to the latest version"},o="Next.js Codemods",d={id:"next-js/v13.0.0/advanced-features/codemods",title:"Next.js Codemods",description:"Use codemods to update your codebase when upgrading Next.js to the latest version",source:"@site/docs/next-js/v13.0.0/advanced-features/codemods.md",sourceDirName:"next-js/v13.0.0/advanced-features",slug:"/next-js/v13.0.0/advanced-features/codemods",permalink:"/next-js/v13.0.0/advanced-features/codemods",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/next-js/v13.0.0/advanced-features/codemods.md",tags:[],version:"current",frontMatter:{description:"Use codemods to update your codebase when upgrading Next.js to the latest version"},sidebar:"tutorialSidebar",previous:{title:"Continuous Integration (CI) Build Caching",permalink:"/next-js/v13.0.0/advanced-features/ci-build-caching"},next:{title:"Next.js Compiler",permalink:"/next-js/v13.0.0/advanced-features/compiler"}},a={},c=[{value:"Usage",id:"usage",level:2},{value:"Next.js 13",id:"nextjs-13",level:2},{value:"<code>new-link</code>",id:"new-link",level:3},{value:"<code>next-image-to-legacy-image</code>",id:"next-image-to-legacy-image",level:3},{value:"<code>next-image-experimental</code> (experimental)",id:"next-image-experimental-experimental",level:3},{value:"Before: intrinsic",id:"before-intrinsic",level:4},{value:"After: intrinsic",id:"after-intrinsic",level:4},{value:"Before: responsive",id:"before-responsive",level:4},{value:"After: responsive",id:"after-responsive",level:4},{value:"Before: fill",id:"before-fill",level:4},{value:"After: fill",id:"after-fill",level:4},{value:"Before: fixed",id:"before-fixed",level:4},{value:"After: fixed",id:"after-fixed",level:4},{value:"Next.js 11",id:"nextjs-11",level:2},{value:"<code>cra-to-next</code> (experimental)",id:"cra-to-next-experimental",level:3},{value:"Next.js 10",id:"nextjs-10",level:2},{value:"<code>add-missing-react-import</code>",id:"add-missing-react-import",level:3},{value:"Next.js 9",id:"nextjs-9",level:2},{value:"<code>name-default-component</code>",id:"name-default-component",level:3},{value:"Usage",id:"usage-1",level:4},{value:"<code>withamp-to-config</code>",id:"withamp-to-config",level:3},{value:"Usage",id:"usage-2",level:4},{value:"Next.js 6",id:"nextjs-6",level:2},{value:"<code>url-to-withrouter</code>",id:"url-to-withrouter",level:3},{value:"Usage",id:"usage-3",level:4}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"nextjs-codemods",children:"Next.js Codemods"}),"\n",(0,t.jsx)(n.p,{children:"Next.js provides Codemod transformations to help upgrade your Next.js codebase when a feature is deprecated."}),"\n",(0,t.jsx)(n.p,{children:"Codemods are transformations that run on your codebase programmatically. This allows for a large amount of changes to be applied without having to manually go through every file."}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"npx @next/codemod <transform> <path>"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"transform"})," - name of transform, see available transforms below."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"path"})," - files or directory to transform"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--dry"})," Do a dry-run, no code will be edited"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--print"})," Prints the changed output for comparison"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"nextjs-13",children:"Next.js 13"}),"\n",(0,t.jsx)(n.h3,{id:"new-link",children:(0,t.jsx)(n.code,{children:"new-link"})}),"\n",(0,t.jsxs)(n.p,{children:["Safely removes ",(0,t.jsx)(n.code,{children:"<a>"})," from ",(0,t.jsx)(n.code,{children:"next/link"})," or adds ",(0,t.jsx)(n.code,{children:"legacyBehavior"})," prop."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'export default function Page() {\n  return (\n    <Link href="/about">\n      <a>About Us</a>\n    </Link>\n  )\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Transforms into:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'export default function Page() {\n  return <Link href="/about">About Us</Link>\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"next-image-to-legacy-image",children:(0,t.jsx)(n.code,{children:"next-image-to-legacy-image"})}),"\n",(0,t.jsxs)(n.p,{children:["Safely migrates existing Next.js 10, 11, 12 applications importing ",(0,t.jsx)(n.code,{children:"next/image"})," to the renamed ",(0,t.jsx)(n.code,{children:"next/legacy/image"})," import in Next.js 13."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import Image1 from \'next/image\'\nimport Image2 from \'next/future/image\'\n\nexport default function Home() {\n  return (\n    <div>\n      <Image1 src="/test.jpg" width="200" height="300" />\n      <Image2 src="/test.png" width="500" height="400" />\n    </div>\n  )\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Transforms into:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import Image1 from \'next/legacy/image\'\nimport Image2 from \'next/image\'\n\nexport default function Home() {\n  return (\n    <div>\n      <Image1 src="/test.jpg" width="200" height="300" />\n      <Image2 src="/test.png" width="500" height="400" />\n    </div>\n  )\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"next-image-experimental-experimental",children:[(0,t.jsx)(n.code,{children:"next-image-experimental"})," (experimental)"]}),"\n",(0,t.jsxs)(n.p,{children:["Dangerously migrates from ",(0,t.jsx)(n.code,{children:"next/legacy/image"})," to the new ",(0,t.jsx)(n.code,{children:"next/image"})," by adding inline styles and removing unused props."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Removes ",(0,t.jsx)(n.code,{children:"layout"})," prop and adds ",(0,t.jsx)(n.code,{children:"style"})]}),"\n",(0,t.jsxs)(n.li,{children:["Removes ",(0,t.jsx)(n.code,{children:"objectFit"})," prop and adds ",(0,t.jsx)(n.code,{children:"style"})]}),"\n",(0,t.jsxs)(n.li,{children:["Removes ",(0,t.jsx)(n.code,{children:"objectPosition"})," prop and adds ",(0,t.jsx)(n.code,{children:"style"})]}),"\n",(0,t.jsxs)(n.li,{children:["Removes ",(0,t.jsx)(n.code,{children:"lazyBoundary"})," prop"]}),"\n",(0,t.jsxs)(n.li,{children:["Removes ",(0,t.jsx)(n.code,{children:"lazyRoot"})," prop"]}),"\n",(0,t.jsxs)(n.li,{children:["Changes next.config.js ",(0,t.jsx)(n.code,{children:"loader"}),' to "custom", removes ',(0,t.jsx)(n.code,{children:"path"}),", and sets ",(0,t.jsx)(n.code,{children:"loaderFile"})," to a new file."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"before-intrinsic",children:"Before: intrinsic"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nfunction Page() {\n  return <Image src={img} />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"after-intrinsic",children:"After: intrinsic"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nconst css = { maxWidth: '100%', height: 'auto' }\nfunction Page() {\n  return <Image src={img} style={css} />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"before-responsive",children:"Before: responsive"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nfunction Page() {\n  return <Image src={img} layout=\"responsive\" />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"after-responsive",children:"After: responsive"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nconst css = { width: '100%', height: 'auto' }\nfunction Page() {\n  return <Image src={img} sizes=\"100vw\" style={css} />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"before-fill",children:"Before: fill"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nfunction Page() {\n  return <Image src={img} layout=\"fill\" />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"after-fill",children:"After: fill"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nfunction Page() {\n  return <Image src={img} sizes=\"100vw\" fill />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"before-fixed",children:"Before: fixed"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nfunction Page() {\n  return <Image src={img} layout=\"fixed\" />\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"after-fixed",children:"After: fixed"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import Image from 'next/image'\nimport img from '../img.png'\n\nfunction Page() {\n  return <Image src={img} />\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"nextjs-11",children:"Next.js 11"}),"\n",(0,t.jsxs)(n.h3,{id:"cra-to-next-experimental",children:[(0,t.jsx)(n.code,{children:"cra-to-next"})," (experimental)"]}),"\n",(0,t.jsxs)(n.p,{children:["Migrates a Create React App project to Next.js; creating a pages directory and necessary config to match behavior. Client-side only rendering is leveraged initially to prevent breaking compatibility due to ",(0,t.jsx)(n.code,{children:"window"})," usage during SSR and can be enabled seamlessly to allow gradual adoption of Next.js specific features."]}),"\n",(0,t.jsxs)(n.p,{children:["Please share any feedback related to this transform ",(0,t.jsx)(n.a,{href:"https://github.com/vercel/next.js/discussions/25858",children:"in this discussion"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"nextjs-10",children:"Next.js 10"}),"\n",(0,t.jsx)(n.h3,{id:"add-missing-react-import",children:(0,t.jsx)(n.code,{children:"add-missing-react-import"})}),"\n",(0,t.jsxs)(n.p,{children:["Transforms files that do not import ",(0,t.jsx)(n.code,{children:"React"})," to include the import in order for the new ",(0,t.jsx)(n.a,{href:"https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html",children:"React JSX transform"})," to work."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// my-component.js\nexport default class Home extends React.Component {\n  render() {\n    return <div>Hello World</div>\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Transforms into:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// my-component.js\nimport React from 'react'\nexport default class Home extends React.Component {\n  render() {\n    return <div>Hello World</div>\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"nextjs-9",children:"Next.js 9"}),"\n",(0,t.jsx)(n.h3,{id:"name-default-component",children:(0,t.jsx)(n.code,{children:"name-default-component"})}),"\n",(0,t.jsxs)(n.p,{children:["Transforms anonymous components into named components to make sure they work with ",(0,t.jsx)(n.a,{href:"https://nextjs.org/blog/next-9-4#fast-refresh",children:"Fast Refresh"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// my-component.js\nexport default function () {\n  return <div>Hello World</div>\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Transforms into:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// my-component.js\nexport default function MyComponent() {\n  return <div>Hello World</div>\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The component will have a camel cased name based on the name of the file, and it also works with arrow functions."}),"\n",(0,t.jsx)(n.h4,{id:"usage-1",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"Go to your project"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd path-to-your-project/\n"})}),"\n",(0,t.jsx)(n.p,{children:"Run the codemod:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npx @next/codemod name-default-component\n"})}),"\n",(0,t.jsx)(n.h3,{id:"withamp-to-config",children:(0,t.jsx)(n.code,{children:"withamp-to-config"})}),"\n",(0,t.jsxs)(n.p,{children:["Transforms the ",(0,t.jsx)(n.code,{children:"withAmp"})," HOC into Next.js 9 page configuration."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Before\nimport { withAmp } from 'next/amp'\n\nfunction Home() {\n  return <h1>My AMP Page</h1>\n}\n\nexport default withAmp(Home)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// After\nexport default function Home() {\n  return <h1>My AMP Page</h1>\n}\n\nexport const config = {\n  amp: true,\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"usage-2",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"Go to your project"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd path-to-your-project/\n"})}),"\n",(0,t.jsx)(n.p,{children:"Run the codemod:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npx @next/codemod withamp-to-config\n"})}),"\n",(0,t.jsx)(n.h2,{id:"nextjs-6",children:"Next.js 6"}),"\n",(0,t.jsx)(n.h3,{id:"url-to-withrouter",children:(0,t.jsx)(n.code,{children:"url-to-withrouter"})}),"\n",(0,t.jsxs)(n.p,{children:["Transforms the deprecated automatically injected ",(0,t.jsx)(n.code,{children:"url"})," property on top level pages to using ",(0,t.jsx)(n.code,{children:"withRouter"})," and the ",(0,t.jsx)(n.code,{children:"router"})," property it injects. Read more here: ",(0,t.jsx)(n.a,{href:"https://nextjs.org/docs/messages/url-deprecated",children:"https://nextjs.org/docs/messages/url-deprecated"})]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// From\nimport React from 'react'\nexport default class extends React.Component {\n  render() {\n    const { pathname } = this.props.url\n    return <div>Current pathname: {pathname}</div>\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// To\nimport React from 'react'\nimport { withRouter } from 'next/router'\nexport default withRouter(\n  class extends React.Component {\n    render() {\n      const { pathname } = this.props.router\n      return <div>Current pathname: {pathname}</div>\n    }\n  }\n)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This is one case. All the cases that are transformed (and tested) can be found in the ",(0,t.jsxs)(n.a,{href:"https://github.com/vercel/next.js/tree/canary/packages/next-codemod/transforms/__testfixtures__/url-to-withrouter",children:[(0,t.jsx)(n.code,{children:"__testfixtures__"})," directory"]}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"usage-3",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"Go to your project"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd path-to-your-project/\n"})}),"\n",(0,t.jsx)(n.p,{children:"Run the codemod:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npx @next/codemod url-to-withrouter\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>d,a:()=>o});var t=r(7294);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);