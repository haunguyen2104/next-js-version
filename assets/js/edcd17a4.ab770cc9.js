"use strict";(self.webpackChunknext_version=self.webpackChunknext_version||[]).push([[1822],{3062:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var t=s(5893),o=s(1151);const r={description:"API\xa0Routes\xa0provide built-in request helpers that parse the incoming request. Learn more about them here."},i="API Routes Request Helpers",c={id:"next-js/v13.0.0/api-routes/request-helpers",title:"API Routes Request Helpers",description:"API\xa0Routes\xa0provide built-in request helpers that parse the incoming request. Learn more about them here.",source:"@site/docs/next-js/v13.0.0/api-routes/request-helpers.md",sourceDirName:"next-js/v13.0.0/api-routes",slug:"/next-js/v13.0.0/api-routes/request-helpers",permalink:"/next-js/v13.0.0/api-routes/request-helpers",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/next-js/v13.0.0/api-routes/request-helpers.md",tags:[],version:"current",frontMatter:{description:"API\xa0Routes\xa0provide built-in request helpers that parse the incoming request. Learn more about them here."},sidebar:"tutorialSidebar",previous:{title:"API Routes",permalink:"/next-js/v13.0.0/api-routes/introduction"},next:{title:"API Routes Response Helpers",permalink:"/next-js/v13.0.0/api-routes/response-helpers"}},a={},l=[{value:"Custom config",id:"custom-config",level:2},{value:"Extending the <code>req</code>/<code>res</code> objects with TypeScript",id:"extending-the-reqres-objects-with-typescript",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"api-routes-request-helpers",children:"API Routes Request Helpers"}),"\n",(0,t.jsxs)(s,{open:!0,children:[(0,t.jsx)("summary",{children:(0,t.jsx)("b",{children:"Examples"})}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/api-routes-middleware",children:"API Routes Request Helpers"})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/api-routes-cors",children:"API Routes with CORS"})})]})]}),"\n",(0,t.jsxs)(n.p,{children:["API\xa0Routes\xa0provide\xa0built-in\xa0request helpers\xa0which\xa0parse\xa0the\xa0incoming request (",(0,t.jsx)(n.code,{children:"req"}),"):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"req.cookies"})," - An object containing the cookies sent by the request. Defaults to ",(0,t.jsx)(n.code,{children:"{}"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"req.query"})," - An object containing the ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Query_string",children:"query string"}),". Defaults to ",(0,t.jsx)(n.code,{children:"{}"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"req.body"})," - An object containing the body parsed by ",(0,t.jsx)(n.code,{children:"content-type"}),", or ",(0,t.jsx)(n.code,{children:"null"})," if no body was sent"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"custom-config",children:"Custom config"}),"\n",(0,t.jsxs)(n.p,{children:["Every API Route can export a ",(0,t.jsx)(n.code,{children:"config"})," object to change the default configuration, which is the following:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export const config = {\n  api: {\n    bodyParser: {\n      sizeLimit: '1mb',\n    },\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"api"})," object includes all config options available for API Routes."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"bodyParser"})," is automatically enabled. If you want to consume the body as a ",(0,t.jsx)(n.code,{children:"Stream"})," or with ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/raw-body",children:(0,t.jsx)(n.code,{children:"raw-body"})}),", you can set this to ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["One use case for disabling the automatic ",(0,t.jsx)(n.code,{children:"bodyParsing"})," is to allow you to verify the raw body of a ",(0,t.jsx)(n.strong,{children:"webhook"})," request, for example ",(0,t.jsx)(n.a,{href:"https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks#validating-payloads-from-github",children:"from GitHub"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export const config = {\n  api: {\n    bodyParser: false,\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"bodyParser.sizeLimit"})," is the maximum size allowed for the parsed body, in any format supported by ",(0,t.jsx)(n.a,{href:"https://github.com/visionmedia/bytes.js",children:"bytes"}),", like so:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export const config = {\n  api: {\n    bodyParser: {\n      sizeLimit: '500kb',\n    },\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"externalResolver"})," is an explicit flag that tells the server that this route is being handled by an external resolver like ",(0,t.jsx)(n.em,{children:"express"})," or ",(0,t.jsx)(n.em,{children:"connect"}),". Enabling this option disables warnings for unresolved requests."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export const config = {\n  api: {\n    externalResolver: true,\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"responseLimit"})," is automatically enabled, warning when an API Routes' response body is over 4MB."]}),"\n",(0,t.jsxs)(n.p,{children:["If you are not using Next.js in a serverless environment, and understand the performance implications of not using a CDN or dedicated media host, you can set this limit to ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export const config = {\n  api: {\n    responseLimit: false,\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"responseLimit"})," can also take the number of bytes or any string format supported by ",(0,t.jsx)(n.code,{children:"bytes"}),", for example ",(0,t.jsx)(n.code,{children:"1000"}),", ",(0,t.jsx)(n.code,{children:"'500kb'"})," or ",(0,t.jsx)(n.code,{children:"'3mb'"}),".\nThis value will be the maximum response size before a warning is displayed. Default is 4MB. (see above)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"export const config = {\n  api: {\n    responseLimit: '8mb',\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"extending-the-reqres-objects-with-typescript",children:["Extending the ",(0,t.jsx)(n.code,{children:"req"}),"/",(0,t.jsx)(n.code,{children:"res"})," objects with TypeScript"]}),"\n",(0,t.jsxs)(n.p,{children:["For better type-safety, it is not recommended to extend the ",(0,t.jsx)(n.code,{children:"req"})," and ",(0,t.jsx)(n.code,{children:"res"})," objects. Instead, use functions to work with them:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// utils/cookies.ts\n\nimport { serialize, CookieSerializeOptions } from 'cookie'\nimport { NextApiResponse } from 'next'\n\n/**\n * This sets `cookie` using the `res` object\n */\n\nexport const setCookie = (\n  res: NextApiResponse,\n  name: string,\n  value: unknown,\n  options: CookieSerializeOptions = {}\n) => {\n  const stringValue =\n    typeof value === 'object' ? 'j:' + JSON.stringify(value) : String(value)\n\n  if (typeof options.maxAge === 'number') {\n    options.expires = new Date(Date.now() + options.maxAge * 1000)\n  }\n\n  res.setHeader('Set-Cookie', serialize(name, stringValue, options))\n}\n\n// pages/api/cookies.ts\n\nimport { NextApiRequest, NextApiResponse } from 'next'\nimport { setCookie } from '../../utils/cookies'\n\nconst handler = (req: NextApiRequest, res: NextApiResponse) => {\n  // Calling our pure function using the `res` object, it will add the `set-cookie` header\n  setCookie(res, 'Next.js', 'api-middleware!')\n  // Return the `set-cookie` header so we can display it in the browser and show that it works!\n  res.end(res.getHeader('Set-Cookie'))\n}\n\nexport default handler\n"})}),"\n",(0,t.jsx)(n.p,{children:"If you can't avoid these objects from being extended, you have to create your own type to include the extra properties:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// pages/api/foo.ts\n\nimport { NextApiRequest, NextApiResponse } from 'next'\nimport { withFoo } from 'external-lib-foo'\n\ntype NextApiRequestWithFoo = NextApiRequest & {\n  foo: (bar: string) => void\n}\n\nconst handler = (req: NextApiRequestWithFoo, res: NextApiResponse) => {\n  req.foo('bar') // we can now use `req.foo` without type errors\n  res.end('ok')\n}\n\nexport default withFoo(handler)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Keep in mind this is not safe since the code will still compile even if you remove ",(0,t.jsx)(n.code,{children:"withFoo()"})," from the export."]})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>i});var t=s(7294);const o={},r=t.createContext(o);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);