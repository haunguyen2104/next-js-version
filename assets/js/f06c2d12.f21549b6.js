"use strict";(self.webpackChunknext_version=self.webpackChunknext_version||[]).push([[9282],{5220:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>h});var s=n(5893),r=n(1151);const i={description:"Learn about authentication patterns in Next.js apps and explore a few examples."},a="Authentication",o={id:"next-js/v13.0.1/authentication",title:"Authentication",description:"Learn about authentication patterns in Next.js apps and explore a few examples.",source:"@site/docs/next-js/v13.0.1/authentication.md",sourceDirName:"next-js/v13.0.1",slug:"/next-js/v13.0.1/authentication",permalink:"/next-js/v13.0.1/authentication",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/next-js/v13.0.1/authentication.md",tags:[],version:"current",frontMatter:{description:"Learn about authentication patterns in Next.js apps and explore a few examples."},sidebar:"tutorialSidebar",previous:{title:"API Routes Response Helpers",permalink:"/next-js/v13.0.1/api-routes/response-helpers"},next:{title:"Built-In CSS Support",permalink:"/next-js/v13.0.1/basic-features/built-in-css-support"}},c={},h=[{value:"Authentication Patterns",id:"authentication-patterns",level:2},{value:"Authenticating Statically Generated Pages",id:"authenticating-statically-generated-pages",level:3},{value:"Authenticating Server-Rendered Pages",id:"authenticating-server-rendered-pages",level:3},{value:"Authentication Providers",id:"authentication-providers",level:2},{value:"Bring Your Own Database",id:"bring-your-own-database",level:3},{value:"Other Providers",id:"other-providers",level:3},{value:"Related",id:"related",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsx)(t.p,{children:"Authentication verifies who a user is, while authorization controls what a user can access. Next.js supports multiple authentication patterns, each designed for different use cases. This page will go through each case so that you can choose based on your constraints."}),"\n",(0,s.jsx)(t.h2,{id:"authentication-patterns",children:"Authentication Patterns"}),"\n",(0,s.jsxs)(t.p,{children:["The first step to identifying which authentication pattern you need is understanding the ",(0,s.jsx)(t.a,{href:"/docs/basic-features/data-fetching/overview.md",children:"data-fetching strategy"})," you want. We can then determine which authentication providers support this strategy. There are two main patterns:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Use ",(0,s.jsx)(t.a,{href:"/docs/basic-features/pages.md#static-generation-recommended",children:"static generation"})," to server-render a loading state, followed by fetching user data client-side."]}),"\n",(0,s.jsxs)(t.li,{children:["Fetch user data ",(0,s.jsx)(t.a,{href:"/docs/basic-features/pages.md#server-side-rendering",children:"server-side"})," to eliminate a flash of unauthenticated content."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"authenticating-statically-generated-pages",children:"Authenticating Statically Generated Pages"}),"\n",(0,s.jsxs)(t.p,{children:["Next.js automatically determines that a page is static if there are no blocking data requirements. This means the absence of ",(0,s.jsx)(t.a,{href:"/docs/basic-features/data-fetching/get-server-side-props.md",children:(0,s.jsx)(t.code,{children:"getServerSideProps"})})," and ",(0,s.jsx)(t.code,{children:"getInitialProps"})," in the page. Instead, your page can render a loading state from the server, followed by fetching the user client-side."]}),"\n",(0,s.jsxs)(t.p,{children:["One advantage of this pattern is it allows pages to be served from a global CDN and preloaded using ",(0,s.jsx)(t.a,{href:"/docs/api-reference/next/link.md",children:(0,s.jsx)(t.code,{children:"next/link"})}),". In practice, this results in a faster TTI (",(0,s.jsx)(t.a,{href:"https://web.dev/interactive/",children:"Time to Interactive"}),")."]}),"\n",(0,s.jsx)(t.p,{children:"Let's look at an example for a profile page. This will initially render a loading skeleton. Once the request for a user has finished, it will show the user's name:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",children:"// pages/profile.js\n\nimport useUser from '../lib/useUser'\nimport Layout from '../components/Layout'\n\nconst Profile = () => {\n  // Fetch the user client-side\n  const { user } = useUser({ redirectTo: '/login' })\n\n  // Server-render loading state\n  if (!user || user.isLoggedIn === false) {\n    return <Layout>Loading...</Layout>\n  }\n\n  // Once the user request finishes, show the user\n  return (\n    <Layout>\n      <h1>Your Profile</h1>\n      <pre>{JSON.stringify(user, null, 2)}</pre>\n    </Layout>\n  )\n}\n\nexport default Profile\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You can view this ",(0,s.jsx)(t.a,{href:"https://iron-session-example.vercel.app/",children:"example in action"}),". Check out the ",(0,s.jsx)(t.a,{href:"https://github.com/vercel/next.js/tree/canary/examples/with-iron-session",children:(0,s.jsx)(t.code,{children:"with-iron-session"})})," example to see how it works."]}),"\n",(0,s.jsx)(t.h3,{id:"authenticating-server-rendered-pages",children:"Authenticating Server-Rendered Pages"}),"\n",(0,s.jsxs)(t.p,{children:["If you export an ",(0,s.jsx)(t.code,{children:"async"})," function called ",(0,s.jsx)(t.a,{href:"/docs/basic-features/data-fetching/get-server-side-props.md",children:(0,s.jsx)(t.code,{children:"getServerSideProps"})})," from a page, Next.js will pre-render this page on each request using the data returned by ",(0,s.jsx)(t.code,{children:"getServerSideProps"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",children:"export async function getServerSideProps(context) {\n  return {\n    props: {}, // Will be passed to the page component as props\n  }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Let's transform the profile example to use ",(0,s.jsx)(t.a,{href:"/docs/basic-features/pages#server-side-rendering",children:"server-side rendering"}),". If there's a session, return ",(0,s.jsx)(t.code,{children:"user"})," as a prop to the ",(0,s.jsx)(t.code,{children:"Profile"})," component in the page. Notice there is not a loading skeleton in ",(0,s.jsx)(t.a,{href:"https://iron-session-example.vercel.app/",children:"this example"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",children:"// pages/profile.js\n\nimport withSession from '../lib/session'\nimport Layout from '../components/Layout'\n\nexport const getServerSideProps = withSession(async function ({ req, res }) {\n  const { user } = req.session\n\n  if (!user) {\n    return {\n      redirect: {\n        destination: '/login',\n        permanent: false,\n      },\n    }\n  }\n\n  return {\n    props: { user },\n  }\n})\n\nconst Profile = ({ user }) => {\n  // Show the user. No loading state is required\n  return (\n    <Layout>\n      <h1>Your Profile</h1>\n      <pre>{JSON.stringify(user, null, 2)}</pre>\n    </Layout>\n  )\n}\n\nexport default Profile\n"})}),"\n",(0,s.jsxs)(t.p,{children:["An advantage of this pattern is preventing a flash of unauthenticated content before redirecting. It's important to note fetching user data in ",(0,s.jsx)(t.code,{children:"getServerSideProps"})," will block rendering until the request to your authentication provider resolves. To prevent creating a bottleneck and increasing your TTFB (",(0,s.jsx)(t.a,{href:"https://web.dev/time-to-first-byte/",children:"Time to First Byte"}),"), you should ensure your authentication lookup is fast. Otherwise, consider ",(0,s.jsx)(t.a,{href:"#authenticating-statically-generated-pages",children:"static generation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"authentication-providers",children:"Authentication Providers"}),"\n",(0,s.jsx)(t.p,{children:"Now that we've discussed authentication patterns, let's look at specific providers and explore how they're used with Next.js."}),"\n",(0,s.jsx)(t.h3,{id:"bring-your-own-database",children:"Bring Your Own Database"}),"\n",(0,s.jsxs)(n,{open:!0,children:[(0,s.jsx)("summary",{children:(0,s.jsx)("b",{children:"Examples"})}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-iron-session",children:"with-iron-session"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/nextauthjs/next-auth-example",children:"next-auth-example"})})]})]}),"\n",(0,s.jsx)(t.p,{children:"If you have an existing database with user data, you'll likely want to utilize an open-source solution that's provider agnostic."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If you want a low-level, encrypted, and stateless session utility use ",(0,s.jsx)(t.a,{href:"https://github.com/vercel/next.js/tree/canary/examples/with-iron-session",children:(0,s.jsx)(t.code,{children:"iron-session"})}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["If you want a full-featured authentication system with built-in providers (Google, Facebook, GitHub\u2026), JWT, JWE, email/password, magic links and more\u2026 use ",(0,s.jsx)(t.a,{href:"https://github.com/nextauthjs/next-auth-example",children:(0,s.jsx)(t.code,{children:"next-auth"})}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Both of these libraries support either authentication pattern. If you're interested in ",(0,s.jsx)(t.a,{href:"http://www.passportjs.org/",children:"Passport"}),", we also have examples for it using secure and encrypted cookies:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://github.com/vercel/next.js/tree/canary/examples/with-passport",children:"with-passport"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://github.com/vercel/next.js/tree/canary/examples/with-passport-and-next-connect",children:"with-passport-and-next-connect"})}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"other-providers",children:"Other Providers"}),"\n",(0,s.jsxs)(t.p,{children:["To see examples with other authentication providers, check out the ",(0,s.jsx)(t.a,{href:"https://github.com/vercel/next.js/tree/canary/examples",children:"examples folder"}),"."]}),"\n",(0,s.jsxs)(n,{open:!0,children:[(0,s.jsx)("summary",{children:(0,s.jsx)("b",{children:"Examples"})}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/auth0",children:"Auth0"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-clerk",children:"Clerk"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-firebase-authentication",children:"Firebase"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-magic",children:"Magic"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-nhost-auth-realtime-graphql",children:"Nhost"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/examples/tree/main/solutions/auth-with-ory",children:"Ory"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-supabase-auth-realtime-db",children:"Supabase"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-supertokens",children:"Supertokens"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/with-userbase",children:"Userbase"})})]})]}),"\n",(0,s.jsx)(t.h2,{id:"related",children:"Related"}),"\n",(0,s.jsx)(t.p,{children:"For more information on what to do next, we recommend the following sections:"}),"\n",(0,s.jsx)("div",{class:"card",children:(0,s.jsxs)("a",{href:"/docs/basic-features/pages.md",children:[(0,s.jsx)("b",{children:"Pages:"}),(0,s.jsx)("small",{children:"Learn more about pages and the different pre-rendering methods in Next.js."})]})}),"\n",(0,s.jsx)("div",{class:"card",children:(0,s.jsxs)("a",{href:"/docs/basic-features/data-fetching/overview.md",children:[(0,s.jsx)("b",{children:"Data Fetching:"}),(0,s.jsx)("small",{children:"Learn more about data fetching in Next.js."})]})})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>o,a:()=>a});var s=n(7294);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);